# 6. Защищённые ветки

## 6.1. Назначение и смысл

Защищённые ветки (Protected Branches) ограничивают выполнение операций (`commit`, `push`, `merge`, `force push`, `delete`) только для уполномоченных пользователей. Это предотвращает случайные или несанкционированные изменения в критически важных ветках и обеспечивает:

- стабильность основного кода;
- соблюдение процедур релиза;
- прозрачность и управляемость изменений;
- контроль над тем, кто и при каких условиях выпускает релизы.

Такие ветки выступают «контрольными точками» жизненного цикла продукта: изменить их можно только после прохождения всех этапов разработки, тестирования и согласования.

## 6.2. Какие ветки защищаются

В рамках GitFlow защищаются следующие ветки:

| Ветка           | Назначение                                   | Почему защищается                                                                 |
|-----------------|-----------------------------------------------|------------------------------------------------------------------------------------|
| `main` / `master` | Основная стабильная версия (прод)           | Любое изменение влияет на прод-окружение, доступ ограничен релиз-менеджером        |
| `develop`       | Основная ветка интеграции функций и багфиксов | Нарушение стабильности усложняет тестирование и подготовку релизов                 |
| `release/*`     | Подготовка релиза к выпуску                   | После «заморозки» кода правки допускаются только релиз-менеджеру и QA              |
| `hotfix/*`      | Экстренные исправления продуктивной версии    | Ошибочные действия могут усугубить критические проблемы в продуктиве              |

## 6.3. Разрешённые действия по ролям

| Ветка        | Действие             | Разрешено кому                         | Примечание                                                                 |
|--------------|----------------------|----------------------------------------|-----------------------------------------------------------------------------|
| `main`       | Merge                | Релиз-менеджеру                        | Только после утверждения релиза и проверки QA                              |
|              | Push                 | Только системным CI/CD процессам       | Все изменения поступают через merge request                                |
| `develop`    | Merge                | Релиз-менеджеру, архитектору           | После успешного прохождения pipeline                                       |
| `release/*`  | Merge в `main`       | Релиз-менеджеру                        | После согласования и тегирования версии                                   |
|              | Merge в `develop`    | Релиз-менеджеру                        | Для синхронизации изменений                                                |
| `hotfix/*`   | Merge в `main` / `develop` | Релиз-менеджеру                    | После тестирования и выпуска hotfix                                        |
| `feature/*`  | Merge в `develop`    | Разработчикам, QA, релиз-менеджеру     | Только через merge request с ревью                                         |

## 6.4. Зачем это нужно

Защищённые ветки решают несколько задач:

- предотвращают ошибки и конфликтные коммиты: разработчики не смогут случайно отправить экспериментальные изменения напрямую в продуктив или `develop`;
- снижают риск нарушения стабильности: код проходит pipeline, ревью и тестирование;
- гарантируют управляемость релизов: любое изменение согласуется релиз-менеджером и фиксируется в журнале;
- упрощают аудит и расследование инцидентов: легко определить, кто и когда выполнил слияние;
- создают единый стандарт работы: все участники команды следуют единым процедурам под контролем ролей.

## 6.5. Контроль и аудит

- Релиз-менеджер еженедельно проверяет журнал GitLab (вкладка Audit Events) на предмет прямых коммитов или push-операций в защищённые ветки.
- Все отклонения фиксируются в журнале нарушений и рассматриваются на плановом совещании команды разработки.
- При повторных нарушениях применяется временное ограничение прав на репозиторий.
